# MITRE System Design Document V3

The goal of this document is to properly document the functional requirements of our system, as well as to address any security concerns we have and how they can possibly be addressed

## System Overview

The build system is split up into two main parts - the fob and the car codebases. Because these devices overlap many similar features and deal with the same datatypes, they will share much of the same header files, as listed below:

- `util.h`: this file contains structs, various constants, and some helper macros. The codebase is entirely shared between car and fob.
- `uart.h`: this file contains methods for UART communication, EEPROM interfacing, and Random Number Generation. The codebase is entirely shared between the car and fob.
- `firmware.h`: this file contains device-type specific code involving the entrance function and the main program loop.
- `authentication.h`: this file contains functions pertaining to the messaging scheme between a car and fob. Cryptographic constants should **NOT** be stored in this file. Because communication between the car and fob emulates a predefined client-server architecture, there are some functions and variables that should be unique to each device. Either `CAR_TARGET` or `FOB_TARGET` should be set at the top of `authentication.h` to ensure that only the required functions are included in the firmware.

- `secrets.h`: this file is automatically generated by `gen_secrets.py`. This is the only file where cryptographic secrets should be included. For a paired fob / car target, it contains:
    - car shared secret
    - car id
    - factory public key (for features)
    - factory entropy
    
    
*Target*         | Unpaired Fob | Paired Fob | Car |
:--------------- | :------------| :----------| :-- |
car secret       | [ ]          |  [S]       | [S] |
car id           | [ ]          |  [S]       | [S] |
factory public   | [C]          |  [C]       | [C] |
factory entropy  | [U]          |  [U]       | [U] |

- `U` is unique for each device.
- `S` is shared between two devices.
- `C` is always constant

